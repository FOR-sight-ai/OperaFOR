<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>LLM Only Demo</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 2em;
            background: #f9f9f9;
        }

        textarea,
        input,
        button {
            width: 100%;
            padding: 1em;
            margin-bottom: 1em;
            font-family: monospace;
            font-size: 1em;
        }

        pre {
            background: #333;
            color: #eee;
            padding: 1em;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        #configPanel {
            display: none;
            margin-bottom: 1em;
        }

        .toggle-button {
            background-color: #007BFF;
            color: white;
            border: none;
            padding: 0.5em 1em;
            cursor: pointer;
            font-size: 1em;
            margin-bottom: 1em;
        }
    </style>
</head>

<body>
    <h1>LLM Only Demo</h1>
    <button class="toggle-button" onclick="toggleConfig()">Show Configuration</button>
    <div id="configPanel">
        <h3>Configuration (JSON)</h3>
        <textarea id="config" rows="8"></textarea>
    </div>
    <h3>User Request</h3>
    <textarea id="userInput" rows="4">What is 25 + 325 ?</textarea>
    <button onclick="run()">Run</button>
    <h3>Response</h3>
    <pre id="output">Waiting...</pre>
    <script>
        function setConfig(value) {
            localStorage.setItem('llmConfig', value);
        }
        function getConfig() {
            return localStorage.getItem('llmConfig');
        }
        const defaultConfig = `{
  "llm": {
    "endpoint": "https://openrouter.ai/api/v1/chat/completions",
    "model": "mistralai/mistral-small-3.1-24b-instruct:free",
    "apiKey": "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"
  }
}`;
        window.onload = function () {
            const savedConfig = getConfig();
            document.getElementById('config').value = savedConfig || defaultConfig;
        };
        function toggleConfig() {
            const panel = document.getElementById('configPanel');
            const button = document.querySelector('.toggle-button');
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
                button.textContent = 'Hide Configuration';
            } else {
                panel.style.display = 'none';
                button.textContent = 'Show Configuration';
            }
        }
        async function run() {
            const configText = document.getElementById('config').value;
            setConfig(configText);
            const config = JSON.parse(configText);
            const userInput = document.getElementById('userInput').value;
            const output = document.getElementById('output');
            output.textContent = "Calling the agent...\n";

            const llm = config.llm || {};
            const payload = {
                model: llm.model,
                base_url: llm.base_url || llm.endpoint, // compatibility
                api_key: llm.apiKey,
                servers: config.servers || [
                    {
                        type: "StreamableHTTP",
                        config: { url: "localhost:9000/mcp" }
                    }
                ],
                prompt: userInput
            };
            try {
                const res = await fetch("/agent", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(payload)
                });
                if (!res.body) {
                    output.textContent = "Erreur: Pas de flux de r√©ponse.";
                    return;
                }
                const reader = res.body.getReader();
                output.textContent = "";
                const decoder = new TextDecoder();
                let done = false;
                while (!done) {
                    const { value, done: doneReading } = await reader.read();
                    done = doneReading;
                    if (value) {
                        output.textContent += decoder.decode(value, { stream: !done });
                        output.scrollTop = output.scrollHeight;
                    }
                }
            } catch (e) {
                output.textContent = "Erreur: " + e;
            }
        }
    </script>
</body>

</html>
